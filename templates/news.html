<!--  наследуемся от шаблона default.html, который мы создавали для flatpages -->
{% extends 'flatpages/default.html' %} 

<!--  подгружает собственные фильтры для шаблонов -->
{% load custom_filters %}
{% load custom_tags %}

{% block title %}
News
{% endblock title %}
 
<!-- В контенте на странице мы выводим все новости -->
{% block content %}
<h1>Все новости</h1>

{# Добавляем форму, которая объединяет набор полей, которые будут отправляться в запросе #}
<form action="" method="get">
    {# Переменная, которую мы передали через контекст, может сгенерировать нам форму с полями #}
    {{ filterset.form.as_p }}
    {# Добавим кнопку отправки данных формы #}
    <input type="submit" value="Найти" />
</form>

{% for post in page_obj %}
<div class="card">
    <div class="card-body">
        <h6>
            {{ post.title|censor }}
        </h6> 
        <p> 
            {{ post.publication_date|date:'d.M.Y' }}
        </p>       
        <p>
            {% with post_preview=post.preview|censor %}
                {{ post_preview|truncatechars:20 }} 
                <a href="{% url 'post_detail' post.id %}" class="card-link">
                    more
                </a>
            {% endwith %}
        </p>
    </div>        
</div>            
{% endfor %}

<!-- вывод информации о страницах -->
<div class="pagination">
    <span class="step-links">

        {% if page_obj.paginator.num_pages != 1 %}
            <!-- вывод информации о предыдуших страницах -->
            {% if page_obj.has_previous %}
                <a href='?{% url_replace page=1 %}'>1</a>
                {% if page_obj.previous_page_number != 1 %}
                    ...
                    <a href='?{% url_replace page=page_obj.previous_page_number %}'>
                        {{page_obj.previous_page_number}}
                    </a>
                {% endif %}
            {% endif %}

            <!-- вывод информации о текущей странице -->
            <span class="current">
                {{ page_obj.number }}
            </span>

            <!-- вывод информации о следующих страницах -->
            {% if page_obj.has_next %}
                <a href='?{% url_replace page=page_obj.next_page_number %}'>
                    {{page_obj.next_page_number}}
                </a>
                {% if page_obj.paginator.num_pages != page_obj.next_page_number %}
                    ...
                    <a href='?{% url_replace page=page_obj.paginator.num_pages %}'>
                        {{page_obj.paginator.num_pages}}
                    </a>
                {% endif %}
            {% endif %}
        {% endif %}
    </span>
</div>
{% endblock content %}
